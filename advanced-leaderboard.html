<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EcoQuest | Advanced Leaderboard</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .leaderboard-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .leaderboard-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--eco-border);
    }
    
    .tab-btn {
      padding: 12px 24px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .tab-btn.active {
      border-bottom-color: var(--eco-green);
      color: var(--eco-green);
    }
    
    .tab-btn:hover {
      background: var(--eco-sage);
    }
    
    .podium {
      display: flex;
      justify-content: center;
      align-items: end;
      gap: 16px;
      margin: 24px 0;
      height: 200px;
    }
    
    .podium-place {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
    }
    
    .podium-base {
      width: 100px;
      background: linear-gradient(135deg, var(--eco-green), var(--eco-green-dark));
      border-radius: 8px 8px 0 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      position: relative;
    }
    
    .podium-base.first { height: 120px; }
    .podium-base.second { height: 90px; background: linear-gradient(135deg, #c0c0c0, #a0a0a0); }
    .podium-base.third { height: 60px; background: linear-gradient(135deg, #cd7f32, #b8860b); }
    
    .podium-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid white;
      margin-bottom: 8px;
      position: absolute;
      top: -30px;
    }
    
    .podium-crown {
      position: absolute;
      top: -50px;
      font-size: 24px;
    }
    
    .school-battle {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 16px;
      padding: 24px;
      margin: 24px 0;
    }
    
    .battle-header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .battle-schools {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }
    
    .school-card {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    
    .school-score {
      font-size: 32px;
      font-weight: bold;
      margin: 8px 0;
    }
    
    .vs-indicator {
      font-size: 24px;
      font-weight: bold;
      color: #ffd700;
    }
    
    .player-row {
      display: flex;
      align-items: center;
      padding: 12px;
      border-radius: 8px;
      margin: 4px 0;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .player-row:hover {
      background: var(--eco-sage);
      transform: translateX(4px);
    }
    
    .player-rank {
      width: 40px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    
    .rank-1 { color: #ffd700; }
    .rank-2 { color: #c0c0c0; }
    .rank-3 { color: #cd7f32; }
    
    .player-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid var(--eco-border);
      margin: 0 12px;
    }
    
    .player-info {
      flex: 1;
    }
    
    .player-name {
      font-weight: 600;
      font-size: 16px;
    }
    
    .player-school {
      color: var(--eco-muted);
      font-size: 14px;
    }
    
    .player-stats {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .stat-badge {
      background: var(--eco-green);
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .achievement-showcase {
      display: flex;
      gap: 8px;
      margin: 16px 0;
    }
    
    .achievement-badge {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      border: 2px solid;
      background: white;
    }
    
    .badge-silver { border-color: #c0c0c0; color: #c0c0c0; }
    .badge-gold { border-color: #ffd700; color: #ffd700; }
    .badge-platinum { border-color: #e5e4e2; color: #e5e4e2; }
    
    .weekly-challenge {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      color: #333;
    }
    
    .challenge-timer {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin: 12px 0;
    }
    
    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #ff4757;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      animation: pulse 2s infinite;
    }
    
    .live-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }
    
    .competition-card {
      border: 2px solid var(--eco-green);
      border-radius: 16px;
      padding: 20px;
      margin: 16px 0;
      background: linear-gradient(135deg, var(--eco-sage), white);
    }
    
    .prize-pool {
      text-align: center;
      background: var(--eco-green);
      color: white;
      padding: 12px;
      border-radius: 8px;
      margin: 12px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container nav">
      <a class="brand" href="index.html">
        <div class="logo"></div>
        <div class="title">EcoQuest</div>
      </a>
      <div class="nav-links">
        <a class="btn ghost" href="advanced-leaderboard.html">Leaderboard</a>
        <a class="btn ghost" href="quiz.html">Quizzes</a>
        <a class="btn ghost" href="challenges.html">Challenges</a>
        <a class="btn ghost" href="game.html">Mini Game</a>
        <a class="btn ghost" href="eco-simulator.html">Eco Simulator</a>
        <a class="btn ghost" href="certificate.html">Certificate</a>
        <div id="authButtons" class="nav-links" style="display:none"></div>
        <div id="navUser" class="userbar" style="display:none">
          <img alt="avatar" src=""/>
          <span></span>
          <button id="logoutBtn" class="btn">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:20px;">
    <!-- Live Competition Banner -->
    <div class="competition-card">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h3>üèÜ Global Eco Championship 2025</h3>
          <p>Schools compete for the ultimate environmental title!</p>
        </div>
        <div class="live-indicator">
          <div class="live-dot"></div>
          LIVE
        </div>
      </div>
      <div class="prize-pool">
        üí∞ Prize Pool: 10,000 Eco-Points + School Recognition
      </div>
    </div>

    <!-- School Battle Section -->
    <div class="school-battle">
      <div class="battle-header">
        <h2>üî• School vs School Battle</h2>
        <div class="live-indicator">
          <div class="live-dot"></div>
          LIVE COMPETITION
        </div>
      </div>
      <div class="battle-schools">
        <div class="school-card">
          <h3>üè´ Green Valley College</h3>
          <div class="school-score" id="school1Score">2,450</div>
          <div>Total Points</div>
        </div>
        <div class="vs-indicator">VS</div>
        <div class="school-card">
          <h3>üè´ Sunrise Public School</h3>
          <div class="school-score" id="school2Score">2,380</div>
          <div>Total Points</div>
        </div>
      </div>
    </div>

    <!-- Weekly Challenge -->
    <div class="weekly-challenge">
      <h3 style="text-align: center;">‚ö° Weekly Challenge: Plant 1000 Trees</h3>
      <div class="challenge-timer" id="weeklyTimer">3d 14h 32m remaining</div>
      <div class="progress-bar" style="height: 12px;">
        <div class="progress-fill" style="width: 67%; background: linear-gradient(90deg, #ff9a9e, #fecfef);"></div>
      </div>
      <div style="text-align: center; margin-top: 8px;">
        <strong>670/1000 trees planted globally</strong>
      </div>
    </div>

    <!-- Leaderboard Tabs -->
    <div class="leaderboard-tabs">
      <button class="tab-btn active" data-tab="global">üåç Global</button>
      <button class="tab-btn" data-tab="school">üè´ My School</button>
      <button class="tab-btn" data-tab="weekly">‚ö° Weekly</button>
      <button class="tab-btn" data-tab="achievements">üèÜ Achievements</button>
    </div>

    <div class="leaderboard-container">
      <!-- Main Leaderboard -->
      <div class="card">
        <div id="globalTab" class="tab-content">
          <h3>üåç Global Champions</h3>
          
          <!-- Podium -->
          <div class="podium">
            <div class="podium-place">
              <div class="podium-crown">üëë</div>
              <img class="podium-avatar" id="podium2Avatar" alt="2nd place">
              <div class="podium-base second">
                <div style="margin-top: 30px;">
                  <div id="podium2Name">Player 2</div>
                  <div id="podium2Points">0</div>
                </div>
              </div>
            </div>
            
            <div class="podium-place">
              <div class="podium-crown">üëë</div>
              <img class="podium-avatar" id="podium1Avatar" alt="1st place">
              <div class="podium-base first">
                <div style="margin-top: 30px;">
                  <div id="podium1Name">Player 1</div>
                  <div id="podium1Points">0</div>
                </div>
              </div>
            </div>
            
            <div class="podium-place">
              <div class="podium-crown">ü•â</div>
              <img class="podium-avatar" id="podium3Avatar" alt="3rd place">
              <div class="podium-base third">
                <div style="margin-top: 30px;">
                  <div id="podium3Name">Player 3</div>
                  <div id="podium3Points">0</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Player List -->
          <div id="globalLeaderboard"></div>
        </div>
        
        <div id="schoolTab" class="tab-content" style="display: none;">
          <h3>üè´ School Leaderboard</h3>
          <div id="schoolLeaderboard"></div>
        </div>
        
        <div id="weeklyTab" class="tab-content" style="display: none;">
          <h3>‚ö° Weekly Champions</h3>
          <div id="weeklyLeaderboard"></div>
        </div>
        
        <div id="achievementsTab" class="tab-content" style="display: none;">
          <h3>üèÜ Achievement Leaders</h3>
          <div id="achievementLeaderboard"></div>
        </div>
      </div>
      
      <!-- Side Panel -->
      <div class="card">
        <h3>üìä Your Stats</h3>
        <div id="userStats">
          <div class="stat-item">
            <span>üèÜ Global Rank</span>
            <span class="stat-value" id="globalRank">#-</span>
          </div>
          <div class="stat-item">
            <span>üè´ School Rank</span>
            <span class="stat-value" id="schoolRank">#-</span>
          </div>
          <div class="stat-item">
            <span>üíö Total Points</span>
            <span class="stat-value" id="totalPoints">0</span>
          </div>
          <div class="stat-item">
            <span>üìà This Week</span>
            <span class="stat-value" id="weeklyPoints">+0</span>
          </div>
        </div>
        
        <div class="achievement-showcase">
          <div class="achievement-badge badge-silver" title="Silver Badge">ü•à</div>
          <div class="achievement-badge badge-gold" title="Gold Badge">ü•á</div>
          <div class="achievement-badge badge-platinum" title="Platinum Badge">üíé</div>
        </div>
        
        <h4>üéØ Next Milestone</h4>
        <div class="progress-bar">
          <div class="progress-fill" id="milestoneProgress" style="width: 45%"></div>
        </div>
        <p class="helper">45 points to Gold Badge</p>
        
        <h4>üî• Recent Activity</h4>
        <div id="recentActivity">
          <div style="font-size: 14px; padding: 8px 0; border-bottom: 1px solid var(--eco-border);">
            üå≥ Completed tree planting challenge (+50 pts)
          </div>
          <div style="font-size: 14px; padding: 8px 0; border-bottom: 1px solid var(--eco-border);">
            üß† Aced environmental quiz (+25 pts)
          </div>
          <div style="font-size: 14px; padding: 8px 0;">
            ‚ôªÔ∏è Shared recycling tips (+10 pts)
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="app.js"></script>
  <script src="ai-chatbot.js"></script>
  <script>
    const user = Eco.requireAuth();
    
    // Enhanced user data with more realistic competition
    const enhancedUsers = [
      { name: 'Arjun Mehta', school: 'Sunrise Public School', points: 2850, badges: ['Silver','Gold','Platinum'], weeklyPoints: 280, avatar: null },
      { name: 'Aarya Sharma', school: 'Green Valley College', points: 2720, badges: ['Silver','Gold','Platinum'], weeklyPoints: 245, avatar: null },
      { name: 'Priya Singh', school: 'Riverdale College', points: 2650, badges: ['Silver','Gold','Platinum'], weeklyPoints: 190, avatar: null },
      { name: 'Vihaan Patel', school: 'Sunrise Public School', points: 2480, badges: ['Silver','Gold'], weeklyPoints: 220, avatar: null },
      { name: 'Dev Rao', school: 'Coastal Institute', points: 2350, badges: ['Silver','Gold'], weeklyPoints: 180, avatar: null },
      { name: 'Kiara Dsouza', school: 'Hillside High', points: 2180, badges: ['Silver','Gold'], weeklyPoints: 165, avatar: null },
      { name: 'Isha Nair', school: 'Riverdale College', points: 2050, badges: ['Silver'], weeklyPoints: 140, avatar: null },
      { name: 'Kabir Khan', school: 'Green Valley College', points: 1920, badges: ['Silver'], weeklyPoints: 125, avatar: null },
      { name: 'Ananya Gupta', school: 'Tech Valley School', points: 1850, badges: ['Silver'], weeklyPoints: 110, avatar: null },
      { name: 'Rohan Joshi', school: 'Mountain View High', points: 1720, badges: ['Silver'], weeklyPoints: 95, avatar: null }
    ];
    
    // Add current user to the list if they exist
    if (user) {
      const userInList = enhancedUsers.find(u => u.name === user.name);
      if (!userInList) {
        enhancedUsers.push({
          name: user.name || user.email,
          school: user.school || 'Unknown School',
          points: user.points || 0,
          badges: user.badges || [],
          weeklyPoints: Math.floor((user.points || 0) * 0.1),
          avatar: user.avatarDataUrl
        });
      }
    }
    
    // Sort users by points
    enhancedUsers.sort((a, b) => b.points - a.points);
    
    // Tab functionality
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active tab
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Show corresponding content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(btn.dataset.tab + 'Tab').style.display = 'block';
      });
    });
    
    // Populate podium
    function populatePodium() {
      if (enhancedUsers.length >= 3) {
        // 1st place
        document.getElementById('podium1Name').textContent = enhancedUsers[0].name;
        document.getElementById('podium1Points').textContent = Eco.formatPoints(enhancedUsers[0].points);
        document.getElementById('podium1Avatar').src = enhancedUsers[0].avatar || Eco.initialsAvatar(enhancedUsers[0].name);
        
        // 2nd place
        document.getElementById('podium2Name').textContent = enhancedUsers[1].name;
        document.getElementById('podium2Points').textContent = Eco.formatPoints(enhancedUsers[1].points);
        document.getElementById('podium2Avatar').src = enhancedUsers[1].avatar || Eco.initialsAvatar(enhancedUsers[1].name);
        
        // 3rd place
        document.getElementById('podium3Name').textContent = enhancedUsers[2].name;
        document.getElementById('podium3Points').textContent = Eco.formatPoints(enhancedUsers[2].points);
        document.getElementById('podium3Avatar').src = enhancedUsers[2].avatar || Eco.initialsAvatar(enhancedUsers[2].name);
      }
    }
    
    // Populate leaderboards
    function populateLeaderboard(containerId, users, startRank = 1) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      users.forEach((userData, index) => {
        const rank = startRank + index;
        const isCurrentUser = user && userData.name === user.name;
        
        const playerRow = document.createElement('div');
        playerRow.className = 'player-row';
        if (isCurrentUser) {
          playerRow.style.background = 'var(--eco-sage)';
          playerRow.style.border = '2px solid var(--eco-green)';
        }
        
        const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : '';
        
        playerRow.innerHTML = `
          <div class="player-rank ${rankClass}">#${rank}</div>
          <img class="player-avatar" src="${userData.avatar || Eco.initialsAvatar(userData.name)}" alt="avatar">
          <div class="player-info">
            <div class="player-name">${userData.name} ${isCurrentUser ? '(You)' : ''}</div>
            <div class="player-school">${userData.school}</div>
          </div>
          <div class="player-stats">
            <div class="stat-badge">${Eco.formatPoints(userData.points)} pts</div>
            <div class="stat-badge" style="background: var(--eco-blue);">+${userData.weeklyPoints} this week</div>
            ${userData.badges.map(badge => {
              const badgeEmoji = badge === 'Platinum' ? 'üíé' : badge === 'Gold' ? 'ü•á' : 'ü•à';
              return `<div class="achievement-badge badge-${badge.toLowerCase()}">${badgeEmoji}</div>`;
            }).join('')}
          </div>
        `;
        
        container.appendChild(playerRow);
      });
    }
    
    // Update user stats
    function updateUserStats() {
      if (!user) return;
      
      const userIndex = enhancedUsers.findIndex(u => u.name === user.name);
      const userSchoolmates = enhancedUsers.filter(u => u.school === user.school);
      const userSchoolIndex = userSchoolmates.findIndex(u => u.name === user.name);
      
      document.getElementById('globalRank').textContent = userIndex >= 0 ? `#${userIndex + 1}` : '#-';
      document.getElementById('schoolRank').textContent = userSchoolIndex >= 0 ? `#${userSchoolIndex + 1}` : '#-';
      document.getElementById('totalPoints').textContent = Eco.formatPoints(user.points || 0);
      document.getElementById('weeklyPoints').textContent = `+${Math.floor((user.points || 0) * 0.1)}`;
    }
    
    // Initialize leaderboards
    populatePodium();
    populateLeaderboard('globalLeaderboard', enhancedUsers.slice(3), 4);
    
    // School leaderboard
    if (user && user.school) {
      const schoolmates = enhancedUsers.filter(u => u.school === user.school);
      populateLeaderboard('schoolLeaderboard', schoolmates);
    }
    
    // Weekly leaderboard (sorted by weekly points)
    const weeklyUsers = [...enhancedUsers].sort((a, b) => b.weeklyPoints - a.weeklyPoints);
    populateLeaderboard('weeklyLeaderboard', weeklyUsers);
    
    // Achievement leaderboard (sorted by badge count)
    const achievementUsers = [...enhancedUsers].sort((a, b) => b.badges.length - a.badges.length);
    populateLeaderboard('achievementLeaderboard', achievementUsers);
    
    updateUserStats();
    
    // Animate school battle scores
    function animateScores() {
      const school1 = document.getElementById('school1Score');
      const school2 = document.getElementById('school2Score');
      
      setInterval(() => {
        const change1 = Math.floor(Math.random() * 10) - 5;
        const change2 = Math.floor(Math.random() * 10) - 5;
        
        const current1 = parseInt(school1.textContent.replace(',', ''));
        const current2 = parseInt(school2.textContent.replace(',', ''));
        
        school1.textContent = Eco.formatPoints(Math.max(0, current1 + change1));
        school2.textContent = Eco.formatPoints(Math.max(0, current2 + change2));
      }, 5000);
    }
    
    // Update weekly timer
    function updateWeeklyTimer() {
      const timer = document.getElementById('weeklyTimer');
      let timeLeft = 3 * 24 * 60 * 60 + 14 * 60 * 60 + 32 * 60; // 3d 14h 32m in seconds
      
      setInterval(() => {
        timeLeft--;
        const days = Math.floor(timeLeft / (24 * 60 * 60));
        const hours = Math.floor((timeLeft % (24 * 60 * 60)) / (60 * 60));
        const minutes = Math.floor((timeLeft % (60 * 60)) / 60);
        
        timer.textContent = `${days}d ${hours}h ${minutes}m remaining`;
      }, 60000);
    }
    
    animateScores();
    updateWeeklyTimer();
  </script>
</body>
</html>
